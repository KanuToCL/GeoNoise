<!doctype html>
<html lang="en" data-theme="default">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GeoNoise</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./styles/theme.css" />
    <link rel="stylesheet" href="./style.css" />
    <script type="importmap">
      {
        "imports": {
          "@geonoise/shared": "/packages/shared/dist/index.js",
          "@geonoise/core": "/packages/core/dist/index.js",
          "@geonoise/core/coords": "/packages/core/dist/coords/index.js",
          "@geonoise/geo": "/packages/geo/dist/index.js",
          "@geonoise/engine": "/packages/engine/dist/index.js",
          "@geonoise/engine-backends": "/packages/engine-backends/dist/index.js",
          "@geonoise/engine-webgpu": "/packages/engine-webgpu/dist/index.js",
          "zod": "https://esm.sh/zod@3.22.4"
        }
      }
    </script>
  </head>
  <body>
    <div class="app-shell">
      <!-- Fullscreen map canvas layer. -->
      <div class="canvas-frame">
        <canvas id="mapCanvas"></canvas>
        <div class="canvas-status">
          <div class="scale-bar">
            <div class="scale-line" id="scaleLine"></div>
            <div class="scale-text" id="scaleText">100 m</div>
          </div>
          <div class="canvas-status-line" aria-live="polite">
            <span class="canvas-status-item">x: <span id="debug-x">0.0</span>m y: <span id="debug-y">0.0</span>m</span>
            <span class="canvas-status-sep">|</span>
            <span class="canvas-status-item">Units: Meters</span>
            <span class="canvas-status-sep">|</span>
            <span class="canvas-status-item">Mode: <span id="debug-mode">Select</span></span>
            <span class="canvas-status-sep">|</span>
            <button
              class="status-refine-button"
              id="refineButton"
              type="button"
              title="Force high-quality refine"
              aria-label="Force high-quality refine"
            >
              <span class="status-refine-icon" aria-hidden="true">‚ü≥</span>
              <span>Refine</span>
            </button>
          </div>
        </div>
        <div class="snap-indicator" id="snapIndicator"></div>
        <div class="canvas-corner">
          <div class="db-legend" id="dbLegend" role="group" aria-label="Decibel legend">
            <div class="db-legend-bar">
              <div class="db-legend-gradient" id="dbLegendGradient" aria-hidden="true"></div>
              <div class="db-legend-labels" id="dbLegendLabels">
                <span>30 dB</span>
                <span>85 dB</span>
              </div>
            </div>
          </div>
          <div class="canvas-help" id="canvasHelp">
            <button
              class="ghost ui-button canvas-help-button"
              id="canvasHelpButton"
              type="button"
              aria-expanded="false"
              aria-label="Canvas help"
            >
              ?
            </button>
            <div class="canvas-help-tooltip" id="canvasHelpTooltip" role="tooltip">
              <div class="canvas-help-title">Canvas controls</div>
              <div class="canvas-help-body">Drag: pan ‚Ä¢ Scroll: zoom ‚Ä¢ Click: select ‚Ä¢ Shift+Drag: duplicate</div>
              <button class="ghost ui-button canvas-help-dismiss" id="canvasHelpDismiss" type="button">Got it</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Floating UI overlay (non-blocking except for interactive elements). -->
      <div class="ui-layer">
        <header class="topbar topbar-floating">
<div class="topbar-left">
            <div class="topbar-actions">
<button class="ghost ui-button undo-redo-btn" id="undoButton" type="button" title="Undo the last change." aria-label="Undo">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 4v6h6"/>
                  <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                </svg>
              </button>
              <button class="ghost ui-button undo-redo-btn" id="redoButton" type="button" title="Redo the last change." aria-label="Redo">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M23 4v6h-6"/>
                  <path d="M20.49 15a9 9 0 1 1-2.13-9.36L23 10"/>
                </svg>
              </button>
<div class="layers-toggle" id="layersToggle">
              <button class="ghost ui-button" id="layersButton" type="button" aria-expanded="false">
                Layers
              </button>
            </div>
            </div>
          </div>
          <div class="topbar-center">
            <div class="brand brand--debossed">
              <div class="brand-icon" aria-hidden="true">
                <span class="brand-ring ring-1"></span>
                <span class="brand-ring ring-2"></span>
                <span class="brand-ring ring-3"></span>
                <span class="brand-core"></span>
              </div>
              <div class="brand-title">geonoise</div>
            </div>
          </div>
          <div class="topbar-right">
            <div class="control-module">
              <div class="run-group">
                <button
                  class="primary ui-button"
                  id="computeButton"
                  type="button"
                  title="Run propagation and update receiver/grid levels."
                >
                  Compute
                </button>
                <!-- Whole-scene noise map ("Mesh All"): compute a padded grid and render as a heatmap overlay. -->
                <button class="primary ui-button" id="meshButton" type="button" title="Generate a whole-scene noise map.">
                  Generate Map
                </button>
                <div class="status-chip status-chip--small" id="computeChip" aria-label="Compute status">Ready</div>
              </div>
              <div class="run-options is-hidden" aria-hidden="true">
                <label for="computePreference">CPU</label>
                <div class="select-shell">
                  <select class="ui-inset" id="computePreference">
                    <option value="cpu">CPU</option>
                  </select>
                </div>
              </div>
<!-- Lightweight feedback for heavy map computation (keeps UI responsive). -->
              <div class="map-toast" id="mapToast" role="status" aria-live="polite"></div>
            </div>
<button class="ghost ui-button" id="aboutButton" type="button" title="Model notes, assumptions, and limitations.">
              Details
            </button>
            <button class="ghost ui-button" id="authorButton" type="button" title="About GeoNoise">
              About
            </button>
          </div>
        </header>

        <!-- Layers popover (outside topbar to escape stacking context) -->
        <div class="layers-popover" id="layersPopover" aria-hidden="true">
          <div class="layers-section">
            <div class="layers-title">Layers</div>
            <label class="toggle">
              <input type="checkbox" id="layerSources" checked />
              <span>Sources</span>
            </label>
            <label class="toggle">
              <input type="checkbox" id="layerReceivers" checked />
              <span>Receivers</span>
            </label>
            <label class="toggle">
              <input type="checkbox" id="layerPanels" checked />
              <span>Measure Grids</span>
            </label>
            <!-- Heatmap layer produced by Generate Map. -->
            <label class="toggle">
              <input type="checkbox" id="layerNoiseMap" />
              <span>Noise Map</span>
            </label>
            <label class="toggle">
              <input type="checkbox" id="layerGrid" />
              <span>Grid Overlay</span>
            </label>
          </div>
        </div>

        <!-- Bottom dock for creation tools. -->
        <div class="dock" id="dock">
          <!-- Collapsed FAB trigger -->
          <button class="dock-fab" id="dockFab" type="button" aria-label="Open tools" aria-expanded="false">
            <span class="dock-fab-icon">+</span>
          </button>
          <!-- Expandable tools container -->
          <div class="dock-expandable" id="dockExpandable">
            <div class="dock-stack">
              <div class="dock-label-stage" id="dockLabelStage" aria-hidden="true">
                <span id="dockLabelText"></span>
              </div>
              <div class="dock-tools" id="toolGrid">
              <button
                class="dock-button ui-button is-active"
                data-tool="select"
                data-label="Select Tool (V)"
                type="button"
                aria-label="Select (V)"
              >
                <span class="dock-label">V</span>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-source"
                data-label="Add Source (S)"
                type="button"
                aria-label="Add Source (S)"
              >
                <span class="dock-label">S</span>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-receiver"
                data-label="Add Receiver (R)"
                type="button"
                aria-label="Add Receiver (R)"
              >
                <span class="dock-label">R</span>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-probe"
                data-label="Add Probe (P)"
                type="button"
                aria-label="Add Probe (P)"
              >
                <svg class="dock-icon" viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    d="M12 3a3 3 0 0 0-3 3v6a3 3 0 0 0 6 0V6a3 3 0 0 0-3-3z"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M5 11a7 7 0 0 0 14 0M12 18v3M8 21h8"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-barrier"
                data-label="Add Barrier (B)"
                type="button"
                aria-label="Add Barrier (B)"
              >
                <span class="dock-label">B</span>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-building"
                data-label="Add Building (H)"
                type="button"
                aria-label="Add Building (H)"
              >
                <span class="dock-label">H</span>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-panel"
                data-label="Add Measure Grid (G)"
                type="button"
                aria-label="Add Measure Grid (G)"
              >
                <span class="dock-label">G</span>
              </button>
            </div>
          </div>
          </div>
          <div class="dock-instruction-bottom">Click to select. Drag to move. Shift+drag to duplicate.</div>
        </div>
        <!-- Settings shortcut uses inline styles to bypass cached/overridden CSS. -->
        <div
          class="settings-footer"
          style="
            position: absolute !important;
            bottom: 160px !important;
            left: 20px !important;
            top: auto !important;
            right: auto !important;
            z-index: 9999 !important;
            display: flex !important;
            flex-direction: column !important;
          "
        >
          <div class="settings-toggle settings-toggle--footer" style="position: relative;">
            <!-- Floating gear button styled to match the light UI pills. -->
            <button
              class="ghost ui-button icon-button"
              id="settingsButton"
              type="button"
              aria-expanded="false"
              aria-controls="settingsPopover"
              aria-label="Simulation physics"
              title="Simulation physics settings"
              style="
                width: 54px !important;
                height: 54px !important;
                border-radius: 50% !important;
                background: rgba(248, 250, 252, 0.95) !important;
                border: 1px solid rgba(148, 163, 184, 0.45) !important;
                color: #475569 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                box-shadow: 0 10px 22px rgba(15, 23, 42, 0.18) !important;
              "
            >
              <span aria-hidden="true" style="font-size: 30px;">‚öô</span>
            </button>

            <!-- Popover uses a darker glass panel for contrast against the canvas. -->
            <div
              class="settings-popover"
              id="settingsPopover"
              aria-hidden="true"
              style="
                position: absolute !important;
                bottom: 100% !important;
                left: 0 !important;
                top: auto !important;
                margin-bottom: 12px !important;
                background: linear-gradient(180deg, rgba(15, 24, 40, 0.98), rgba(10, 18, 31, 0.98)) !important;
                border: 1px solid rgba(148, 163, 184, 0.25) !important;
                border-radius: 18px !important;
                padding: 18px !important;
                width: 280px !important;
                backdrop-filter: blur(16px);
                box-shadow: 0 20px 40px rgba(15, 23, 42, 0.45) !important;
              "
            >
              <div
                class="settings-title"
                style="
                  color: #a5b4c7;
                  font-size: 11px;
                  font-weight: 700;
                  text-transform: uppercase;
                  letter-spacing: 0.18em;
                  margin-bottom: 14px;
                "
              >
                Display Settings
              </div>
              <div class="settings-section" style="margin-bottom: 18px;">
                <label class="property-row property-row-stack" style="display: block; margin-bottom: 12px;">
                  <span
                    style="
                      display: block;
                      font-size: 12px;
                      color: #e2e8f0;
                      margin-bottom: 6px;
                      letter-spacing: 0.02em;
                    "
                  >
                    Frequency Weighting
                  </span>
                  <select
                    class="ui-inset"
                    id="displayWeighting"
                    style="
                      width: 100%;
                      padding: 8px 10px;
                      background: linear-gradient(180deg, #0b1423, #0a1220);
                      color: #f8fafc;
                      border: 1px solid rgba(148, 163, 184, 0.35);
                      border-radius: 10px;
                      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.7), 0 4px 10px rgba(15, 23, 42, 0.35);
                      font-weight: 600;
                    "
                  >
                    <option value="A" selected>A-weighting (dBA)</option>
                    <option value="C">C-weighting (dBC)</option>
                    <option value="Z">Z-weighting (dBZ / Linear)</option>
                  </select>
                </label>
                <label class="property-row property-row-stack" style="display: block;">
                  <span
                    style="
                      display: block;
                      font-size: 12px;
                      color: #e2e8f0;
                      margin-bottom: 6px;
                      letter-spacing: 0.02em;
                    "
                  >
                    Display Band
                  </span>
                  <select
                    class="ui-inset"
                    id="displayBand"
                    style="
                      width: 100%;
                      padding: 8px 10px;
                      background: linear-gradient(180deg, #0b1423, #0a1220);
                      color: #f8fafc;
                      border: 1px solid rgba(148, 163, 184, 0.35);
                      border-radius: 10px;
                      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.7), 0 4px 10px rgba(15, 23, 42, 0.35);
                      font-weight: 600;
                    "
                  >
                    <option value="overall" selected>Overall (Sum)</option>
                    <option value="0">63 Hz</option>
                    <option value="1">125 Hz</option>
                    <option value="2">250 Hz</option>
                    <option value="3">500 Hz</option>
                    <option value="4">1000 Hz</option>
                    <option value="5">2000 Hz</option>
                    <option value="6">4000 Hz</option>
                    <option value="7">8000 Hz</option>
                    <option value="8">16000 Hz</option>
                  </select>
                </label>
              </div>

              <div
                class="settings-title"
                style="
                  color: #a5b4c7;
                  font-size: 11px;
                  font-weight: 700;
                  text-transform: uppercase;
                  letter-spacing: 0.18em;
                  margin-bottom: 14px;
                "
              >
                Map Settings
              </div>
              <div class="settings-section" style="margin-bottom: 18px;">
                <label class="toggle" for="mapRenderStyle" style="color: #e2e8f0; font-size: 13px; margin-bottom: 10px;">
                  <input type="checkbox" id="mapRenderStyle" />
                  <span>Render mode: Smooth / Contours</span>
                </label>
                <div class="property-row map-band-step" id="mapBandStepRow" style="margin-bottom: 10px;">
                  <span style="color: #e2e8f0; font-size: 12px;">Band Step (dB)</span>
                  <input
                    class="ui-inset"
                    id="mapBandStep"
                    type="number"
                    min="1"
                    max="20"
                    step="1"
                    value="3"
                    style="
                      width: 80px;
                      padding: 6px 8px;
                      background: linear-gradient(180deg, #0b1423, #0a1220);
                      color: #f8fafc;
                      border: 1px solid rgba(148, 163, 184, 0.35);
                      border-radius: 8px;
                      font-weight: 600;
                    "
                  />
                </div>
                <label class="toggle" for="mapAutoScale" style="color: #e2e8f0; font-size: 13px;">
                  <input type="checkbox" id="mapAutoScale" checked />
                  <span>Auto-scale colors</span>
                </label>
              </div>

              <div
                class="settings-title"
                style="
                  color: #a5b4c7;
                  font-size: 11px;
                  font-weight: 700;
                  text-transform: uppercase;
                  letter-spacing: 0.18em;
                  margin-bottom: 14px;
                "
              >
                Simulation Physics
              </div>
              <div class="settings-section">
                <label class="property-row property-row-stack" style="display: block; margin-bottom: 12px;">
                  <span
                    style="
                      display: block;
                      font-size: 12px;
                      color: #e2e8f0;
                      margin-bottom: 6px;
                      letter-spacing: 0.02em;
                    "
                  >
                    Atmospheric Model
                  </span>
                  <select
                    class="ui-inset"
                    id="propagationAbsorption"
                    style="
                      width: 100%;
                      padding: 8px 10px;
                      background: linear-gradient(180deg, #0b1423, #0a1220);
                      color: #f8fafc;
                      border: 1px solid rgba(148, 163, 184, 0.35);
                      border-radius: 10px;
                      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.7), 0 4px 10px rgba(15, 23, 42, 0.35);
                      font-weight: 600;
                    "
                  >
                    <option value="iso9613">ISO 9613-1</option>
                    <option value="simple">Simple</option>
                  </select>
                </label>

                <label
                  class="toggle"
                  for="propagationGroundReflection"
                  style="color: #e2e8f0; font-size: 13px;"
                >
                  <input type="checkbox" id="propagationGroundReflection" />
                  <span>Ground Reflection</span>
                </label>

                <label class="property-row property-row-stack" style="display: block; margin-bottom: 12px;">
                  <span
                    style="
                      display: block;
                      font-size: 12px;
                      color: #e2e8f0;
                      margin-bottom: 6px;
                      letter-spacing: 0.02em;
                    "
                  >
                    Ground Type
                  </span>
                  <select
                    class="ui-inset"
                    id="propagationGroundType"
                    style="
                      width: 100%;
                      padding: 8px 10px;
                      background: linear-gradient(180deg, #0b1423, #0a1220);
                      color: #f8fafc;
                      border: 1px solid rgba(148, 163, 184, 0.35);
                      border-radius: 10px;
                      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.7), 0 4px 10px rgba(15, 23, 42, 0.35);
                      font-weight: 600;
                    "
                  >
                    <option value="hard">Hard (Asphalt, Concrete)</option>
                    <option value="mixed" selected>Mixed</option>
                    <option value="soft">Soft (Grass, Soil)</option>
                  </select>
                </label>

                <label class="property-row property-row-stack" style="display: block; margin-bottom: 12px;">
                  <span
                    style="
                      display: block;
                      font-size: 12px;
                      color: #e2e8f0;
                      margin-bottom: 6px;
                      letter-spacing: 0.02em;
                    "
                  >
                    Ground Algorithm
                  </span>
                  <select
                    class="ui-inset"
                    id="propagationGroundModel"
                    style="
                      width: 100%;
                      padding: 8px 10px;
                      background: linear-gradient(180deg, #0b1423, #0a1220);
                      color: #f8fafc;
                      border: 1px solid rgba(148, 163, 184, 0.35);
                      border-radius: 10px;
                      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.7), 0 4px 10px rgba(15, 23, 42, 0.35);
                      font-weight: 600;
                    "
                  >
                    <option value="twoRayPhasor">Two-Ray</option>
                    <option value="legacy">ISO 9613-2</option>
                  </select>
                </label>

                <label class="property-row property-row-stack" style="display: block;">
                  <span
                    style="
                      display: block;
                      font-size: 12px;
                      color: #e2e8f0;
                      margin-bottom: 6px;
                      letter-spacing: 0.02em;
                    "
                  >
                    Spreading Loss
                  </span>
                  <select
                    class="ui-inset"
                    id="propagationSpreading"
                    style="
                      width: 100%;
                      padding: 8px 10px;
                      background: linear-gradient(180deg, #0b1423, #0a1220);
                      color: #f8fafc;
                      border: 1px solid rgba(148, 163, 184, 0.35);
                      border-radius: 10px;
                      box-shadow: inset 0 1px 2px rgba(15, 23, 42, 0.7), 0 4px 10px rgba(15, 23, 42, 0.35);
                      font-weight: 600;
                    "
                  >
                    <option value="spherical">Spherical</option>
                    <option value="cylindrical">Cylindrical</option>
                  </select>
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- Contextual inspector shown only when a selection exists. -->
        <aside class="context-panel" id="contextPanel" aria-hidden="true">
          <div class="context-header" id="contextHeader">
            <div class="context-title">Inspector</div>
            <button class="context-close ui-button" id="contextClose" type="button" aria-label="Close inspector">√ó</button>
          </div>
          <div class="inspector-body">
            <div class="inspector-row">
              <span>Selected</span>
              <strong id="selectionLabel">None</strong>
            </div>
            <div class="inspector-row">
              <span>Mode</span>
              <strong id="modeLabel">Select</strong>
            </div>
            <div class="inspector-row">
              <span>Snap</span>
              <strong>5 m</strong>
            </div>
            <div class="inspector-hint" id="selectionHint">Click an item to edit it.</div>
          </div>
          <div class="context-section">
            <div class="context-section-title">Properties</div>
            <div class="properties" id="propertiesBody">Select an item to edit its properties.</div>
          </div>
          <div class="context-section" id="panelStatsSection">
            <div class="context-section-title">Measure Grid Stats</div>
            <div class="panel-legend" id="panelLegend"></div>
            <div class="panel-stats" id="panelStats"></div>
          </div>
        </aside>

        <aside class="probe-panel" id="probePanel" aria-hidden="true">
          <div class="probe-header">
            <div class="probe-title" id="probeTitle">Probe</div>
            <div class="probe-actions">
              <button
                class="probe-freeze ui-button"
                id="probeFreeze"
                type="button"
                aria-label="Freeze probe snapshot"
                title="Freeze probe snapshot"
              >
                ‚ùÑ
              </button>
              <button
                class="probe-pin ui-button"
                id="probePin"
                type="button"
                aria-label="Pin monitoring window"
                aria-pressed="false"
                title="Pin monitoring window"
              >
                üìå
              </button>
              <button class="probe-close ui-button" id="probeClose" type="button" aria-label="Close probe inspector">
                x
              </button>
            </div>
          </div>
          <div class="probe-meta">
            <span>Frequency Response</span>
            <span class="probe-status" id="probeStatus">Idle</span>
          </div>
          <div class="probe-chart">
            <canvas id="probeChart"></canvas>
          </div>
          <div class="probe-footer">
            <span>Frequency (Hz)</span>
            <span>Amplitude (dB)</span>
          </div>
        </aside>
      </div>
    </div>

    <div class="modal" id="aboutModal" aria-hidden="true">
      <div class="modal-backdrop" data-modal-close></div>
      <div class="modal-card modal-plate" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
        <div class="modal-header">
          <div class="modal-title">
            <h2 id="aboutTitle">Details</h2>
            <p class="modal-subtitle">Real-time 2.5 dimension outdoor acoustic simulation</p>
          </div>
          <button class="modal-close ui-button" id="aboutClose" type="button" aria-label="Close">X</button>
        </div>
        <div class="about-tabs" role="tablist" aria-label="About tabs">
          <button
            class="about-tab is-active"
            type="button"
            role="tab"
            id="aboutTabCurrent"
            aria-selected="true"
            aria-controls="aboutPanelCurrent"
            data-about-tab="current"
          >
            Current
          </button>
          <button
            class="about-tab"
            type="button"
            role="tab"
            id="aboutTabEquations"
            aria-selected="false"
            aria-controls="aboutPanelEquations"
            data-about-tab="equations"
          >
            Full Equations
          </button>
        </div>
        <div
          class="about-panel is-active"
          role="tabpanel"
          id="aboutPanelCurrent"
          aria-labelledby="aboutTabCurrent"
          aria-hidden="false"
          data-about-panel="current"
        >
          <!-- Intro Section -->
          <div class="spec-section spec-section--full">
            <p class="section-intro">
              GeoNoise implements ISO 9613-based outdoor sound propagation with coherent phasor summation
              for multi-path interference modeling. All calculations are performed per octave band (63 Hz ‚Äì 16 kHz).
            </p>
            <div class="formula-highlight">
              L<sub>p</sub>(f) = L<sub>W</sub>(f) - A<sub>div</sub> - A<sub>atm</sub>(f) - A<sub>gr</sub>(f) - A<sub>bar</sub>(f)
            </div>
          </div>

          <!-- Expand All Button -->
          <button class="expand-all-btn" id="expandAllBtn" type="button">expand all</button>

          <!-- Collapsible Physics Sections -->
          <div class="spec-grid" style="gap: 12px;">

            <!-- Geometric Divergence -->
            <div class="collapsible-section spec-section--full" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">geometric divergence (A<sub>div</sub>)</span>
                    <span class="collapsible-subtitle">Spherical spreading: A = 20¬∑log‚ÇÅ‚ÇÄ(d) + 11 dB</span>
                  </div>
                </div>
                <div class="collapsible-chevron">‚ñº</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Point source spherical spreading models how sound energy spreads over an expanding sphere.</p>
                  <div class="formula-highlight">A<sub>div</sub> = 20¬∑log‚ÇÅ‚ÇÄ(d) + 11 dB</div>
                  <p class="spec-text">where d = 3D distance (m), 11 dB = 10¬∑log‚ÇÅ‚ÇÄ(4œÄ) for hemispherical radiation.</p>
                  <p class="spec-text"><strong>Derivation:</strong> Power flux Œ¶ = W/(4œÄr¬≤), therefore L<sub>p</sub> = L<sub>W</sub> - 10¬∑log‚ÇÅ‚ÇÄ(4œÄr¬≤)</p>
                </div>
              </div>
            </div>

            <!-- Atmospheric Absorption -->
            <div class="collapsible-section spec-section--full" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">atmospheric absorption (A<sub>atm</sub>)</span>
                    <span class="collapsible-subtitle">ISO 9613-1 frequency-dependent air absorption</span>
                  </div>
                </div>
                <span class="standards-badge standards-badge--iso">ISO 9613-1</span>
                <div class="collapsible-chevron">‚ñº</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Air absorbs sound energy through viscous, thermal, and molecular relaxation processes.</p>
                  <div class="formula-highlight">A<sub>atm</sub> = Œ±(f) ¬∑ d / 1000 dB</div>
                  <p class="spec-text">The coefficient Œ± combines classical losses with N‚ÇÇ and O‚ÇÇ molecular relaxation:</p>
                  <div class="equation-pill" style="font-size: 12px;">
                    Œ± = Œ±<sub>cl</sub> + (b<sub>N</sub>¬∑f¬≤)/(f<sub>r,N</sub> + f¬≤/f<sub>r,N</sub>) + (b<sub>O</sub>¬∑f¬≤)/(f<sub>r,O</sub> + f¬≤/f<sub>r,O</sub>)
                  </div>
                  <p class="spec-text" style="margin-top: 10px;"><strong>Reference values at 20¬∞C, 70% RH (dB/km):</strong></p>
                  <table class="physics-table">
                    <tr><th>63 Hz</th><th>125 Hz</th><th>250 Hz</th><th>500 Hz</th><th>1 kHz</th><th>2 kHz</th><th>4 kHz</th><th>8 kHz</th><th>16 kHz</th></tr>
                    <tr><td>0.1</td><td>0.4</td><td>1.0</td><td>1.9</td><td>3.7</td><td>9.7</td><td>33</td><td>117</td><td>392</td></tr>
                  </table>
                </div>
              </div>
            </div>

            <!-- Ground Effect -->
            <div class="collapsible-section spec-section--full" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">ground effect (A<sub>gr</sub>)</span>
                    <span class="collapsible-subtitle">Two-ray coherent model with phasor interference</span>
                  </div>
                </div>
                <div class="collapsible-chevron">‚ñº</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Sound reaches the receiver via direct and ground-reflected paths, creating frequency-dependent interference.</p>
                  <pre class="physics-diagram">      S (source)
     /|\
    / | \  r‚ÇÅ = direct path
   /  |  \
  /   |hs \ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ R (receiver)
 /    |    \                  /
/     |     \      r‚ÇÇ       / hr
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ/‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ  Ground (z=0)
             reflection point</pre>
                  <p class="spec-text"><strong>Path lengths:</strong></p>
                  <div class="formula-highlight" style="font-size: 13px;">
                    r‚ÇÅ = ‚àö(d¬≤ + (h<sub>s</sub> - h<sub>r</sub>)¬≤) &nbsp;&nbsp;|&nbsp;&nbsp; r‚ÇÇ = ‚àö(d¬≤ + (h<sub>s</sub> + h<sub>r</sub>)¬≤)
                  </div>
                  <p class="spec-text"><strong>Delany-Bazley normalized impedance:</strong></p>
                  <div class="equation-pill" style="font-size: 12px;">
                    Z<sub>n</sub> = 1 + 9.08(f/œÉ)<sup>-0.75</sup> + j¬∑11.9(f/œÉ)<sup>-0.73</sup>
                  </div>
                  <p class="spec-text">where œÉ = flow resistivity (hard: 200,000, soft: 20,000 Pa¬∑s/m¬≤)</p>
                  <p class="spec-text"><strong>Coherent ground effect:</strong></p>
                  <div class="formula-highlight">
                    A<sub>gr</sub> = -20¬∑log‚ÇÅ‚ÇÄ|1 + Œ≥¬∑(r‚ÇÅ/r‚ÇÇ)¬∑e<sup>jk(r‚ÇÇ-r‚ÇÅ)</sup>|
                  </div>
                  <p class="spec-text">This captures constructive/destructive interference (ground dip phenomenon).</p>
                </div>
              </div>
            </div>

            <!-- Barrier Diffraction -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">barrier diffraction</span>
                    <span class="collapsible-subtitle">Maekawa thin-screen model (1968)</span>
                  </div>
                </div>
                <span class="standards-badge standards-badge--empirical">Maekawa</span>
                <div class="collapsible-chevron">‚ñº</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Sound diffracts over barriers. Attenuation depends on the path difference Œ¥.</p>
                  <pre class="physics-diagram">    S                    R
     \                  /
      \   Œ¥ = A+B-d   /
       A ‚îÄ‚îÄ‚Üí ‚óè ‚Üê‚îÄ‚îÄ B
             ‚îÇ
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïß‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê   Barrier</pre>
                  <div class="formula-highlight">Œ¥ = A + B - d &nbsp;&nbsp;|&nbsp;&nbsp; N = 2Œ¥f/c</div>
                  <p class="spec-text"><strong>Insertion loss:</strong></p>
                  <div class="formula-highlight">A<sub>bar</sub> = 10¬∑log‚ÇÅ‚ÇÄ(3 + 20¬∑N) &nbsp;&nbsp; capped at 20-25 dB</div>
                  <p class="spec-text"><em>Low frequencies diffract easily ‚Üí less attenuation. High frequencies are blocked effectively.</em></p>
                </div>
              </div>
            </div>

            <!-- Building Diffraction -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">building diffraction</span>
                    <span class="collapsible-subtitle">Double-edge over roof + around corners</span>
                  </div>
                </div>
                <div class="collapsible-chevron">‚ñº</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">For thick obstacles, sound diffracts twice (entry + exit edges):</p>
                  <pre class="physics-diagram">    S                              R
     \                            /
      A‚ÇÅ ‚îÄ‚îÄ‚Üí ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè ‚Üê‚îÄ‚îÄ A‚ÇÇ
             ‚îÇ  ROOF  ‚îÇ
      ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïß‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïß‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê   Building</pre>
                  <p class="spec-text"><strong>Path:</strong> Total = A‚ÇÅ + T (roof width) + A‚ÇÇ</p>
                  <div class="formula-highlight">A<sub>bar</sub> = 10¬∑log‚ÇÅ‚ÇÄ(3 + 40¬∑N) &nbsp;&nbsp; capped at 25 dB</div>
                  <p class="spec-text">Note: coefficient is <strong>40</strong> (not 20) for double-edge diffraction.</p>
                  <p class="spec-text"><strong>Horizontal diffraction:</strong> Also computed around building corners using single-edge Maekawa. The minimum-loss path is selected.</p>
                </div>
              </div>
            </div>

            <!-- Wall Reflections -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">wall reflections</span>
                    <span class="collapsible-subtitle">Image source method, 1st-order</span>
                  </div>
                </div>
                <div class="collapsible-chevron">‚ñº</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Reflections from building walls computed using virtual image sources:</p>
                  <pre class="physics-diagram">         Wall
           ‚îÇ
   S ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ R
    \      ‚îÇ      /
     \     ‚îÇ     /
      S'   ‚îÇ   (S' = mirror of S across wall)</pre>
                  <div class="formula-highlight">|Œì| ‚âà 0.9 per reflection (10% absorption)</div>
                  <p class="spec-text">Reflections are validated for line-of-sight and checked against other buildings.</p>
                </div>
              </div>
            </div>

            <!-- Coherent Summation -->
            <div class="collapsible-section spec-section--full" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">coherent phasor summation</span>
                    <span class="collapsible-subtitle">Phase-accurate multi-path interference</span>
                  </div>
                </div>
                <div class="collapsible-chevron">‚ñº</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Multiple paths from the <strong>same source</strong> are summed with phase (capturing interference):</p>
                  <div class="formula-highlight">
                    p<sub>total</sub> = Œ£·µ¢ p·µ¢¬∑e<sup>jœÜ·µ¢</sup> &nbsp;&nbsp; where œÜ·µ¢ = -k¬∑d·µ¢ + œÜ<sub>reflection</sub>
                  </div>
                  <p class="spec-text">This captures:</p>
                  <ul class="spec-list">
                    <li>Constructive interference (paths in-phase ‚Üí +6 dB)</li>
                    <li>Destructive interference (paths out-of-phase ‚Üí deep nulls)</li>
                    <li>Ground dip phenomenon at specific frequencies</li>
                    <li>Comb filtering from wall reflections</li>
                  </ul>
                  <p class="spec-text" style="margin-top: 10px;">Multiple <strong>sources</strong> are summed energetically (incoherent):</p>
                  <div class="formula-highlight">L<sub>p,total</sub> = 10¬∑log‚ÇÅ‚ÇÄ[ Œ£‚±º 10<sup>(Lp,j/10)</sup> ]</div>
                </div>
              </div>
            </div>

            <!-- Accuracy & Limitations -->
            <div class="collapsible-section spec-section--full" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">accuracy & limitations</span>
                    <span class="collapsible-subtitle">Expected precision and model assumptions</span>
                  </div>
                </div>
                <div class="collapsible-chevron">‚ñº</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <div class="accuracy-indicator">
                    <div class="accuracy-dot"></div>
                    <span class="accuracy-text"><strong>Engineering-grade:</strong> ¬± 3 dB typical for distances &lt; 500m</span>
                  </div>
                  <p class="spec-text" style="margin-top: 12px;"><strong>Known Limitations:</strong></p>
                  <ul class="limitations-list">
                    <li>Flat terrain assumed (no topography effects)</li>
                    <li>Neutral atmosphere (no temperature/wind refraction)</li>
                    <li>First-order wall reflections only</li>
                    <li>2.5D geometry (vertical plane diffraction)</li>
                    <li>Homogeneous ground (single type per scene)</li>
                  </ul>
                  <p class="spec-text" style="margin-top: 12px;"><strong>Numerical Guards:</strong></p>
                  <ul class="limitations-list">
                    <li>Distance floor: d<sub>min</sub> = 0.1m to prevent division by zero</li>
                    <li>Angle limits: cos Œ∏ clamped for grazing incidence</li>
                    <li>Impedance cap: |Z| bounded to avoid runaway coefficients</li>
                    <li>Level floor: -100 dB (acoustic silence threshold)</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- References -->
            <div class="collapsible-section spec-section--full" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">references</span>
                    <span class="collapsible-subtitle">Standards and academic sources</span>
                  </div>
                </div>
                <div class="collapsible-chevron">‚ñº</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <ul class="references-list">
                    <li data-ref="[1]">ISO 9613-1:1993 ‚Äî Acoustics ‚Äî Attenuation of sound during propagation outdoors ‚Äî Part 1: Calculation of absorption by atmosphere</li>
                    <li data-ref="[2]">ISO 9613-2:1996 ‚Äî Acoustics ‚Äî Attenuation of sound during propagation outdoors ‚Äî Part 2: General method of calculation</li>
                    <li data-ref="[3]">Maekawa, Z. (1968). "Noise reduction by screens." Applied Acoustics, 1(3), 157-173</li>
                    <li data-ref="[4]">Delany, M.E. & Bazley, E.N. (1970). "Acoustical properties of fibrous absorbent materials." Applied Acoustics, 3(2), 105-116</li>
                    <li data-ref="[5]">Pierce, A.D. (1981). "Acoustics: An Introduction to Its Physical Principles and Applications." McGraw-Hill</li>
                  </ul>
                </div>
              </div>
            </div>

          </div>
        </div>
        <div
          class="about-panel"
          role="tabpanel"
          id="aboutPanelEquations"
          aria-labelledby="aboutTabEquations"
          aria-hidden="true"
          data-about-panel="equations"
        >
          <div class="spec-grid equations-grid">
            <div class="spec-section spec-section--full">
              <div class="spec-heading">CORE LEVELS</div>
              <div class="spec-tray">
                <div class="spec-text">Overall level at receiver:</div>
                <div class="equation-pill">
                  L<sub>p</sub> = L<sub>W</sub> - A<sub>div</sub> - A<sub>atm</sub> - A<sub>gr</sub> - A<sub>bar</sub>
                </div>
                <div class="spec-text">Energetic summation of multiple sources:</div>
                <div class="equation-pill">
                  L<sub>sum</sub> = 10 log<sub>10</sub>( &Sigma; 10<sup>L<sub>i</sub>/10</sup> )
                </div>
                <div class="spec-text">Sound power conversions:</div>
                <div class="equation-pill">L<sub>W</sub> = 10 log<sub>10</sub>(P / 10<sup>-12</sup>)</div>
                <div class="equation-pill">P = 10<sup>-12</sup> &#183; 10<sup>L<sub>W</sub>/10</sup></div>
              </div>
            </div>
            <div class="spec-section">
              <div class="spec-heading">GEOMETRY</div>
              <div class="spec-tray">
                <div class="spec-text">Plan distance:</div>
                <div class="equation-pill">d<sub>2D</sub> = &radic;((x<sub>2</sub>-x<sub>1</sub>)<sup>2</sup> + (y<sub>2</sub>-y<sub>1</sub>)<sup>2</sup>)</div>
                <div class="spec-text">3D distance:</div>
                <div class="equation-pill">
                  d<sub>3D</sub> = &radic;((x<sub>2</sub>-x<sub>1</sub>)<sup>2</sup> + (y<sub>2</sub>-y<sub>1</sub>)<sup>2</sup> + (z<sub>2</sub>-z<sub>1</sub>)<sup>2</sup>)
                </div>
                <div class="spec-text">Direct path used for diffraction reference:</div>
                <div class="equation-pill">d<sub>direct</sub> = &radic;(d<sub>2D</sub><sup>2</sup> + (h<sub>s</sub> - h<sub>r</sub>)<sup>2</sup>)</div>
              </div>
            </div>
            <div class="spec-section">
              <div class="spec-heading">SPREADING</div>
              <div class="spec-tray">
                <div class="spec-text">Point source (spherical):</div>
                <div class="equation-pill">A<sub>div</sub> = 20 log<sub>10</sub>(d) + 11</div>
                <div class="spec-text">Line source (cylindrical):</div>
                <div class="equation-pill">A<sub>div</sub> = 10 log<sub>10</sub>(d) + 8</div>
              </div>
            </div>
            <div class="spec-section spec-section--full">
              <div class="spec-heading">ATMOSPHERIC ABSORPTION</div>
              <div class="spec-tray">
                <div class="spec-text">Path loss:</div>
                <div class="equation-pill">A<sub>atm</sub> = &alpha; &#183; d</div>
                <div class="spec-text">Speed of sound and wavelength:</div>
                <div class="equation-pill">c = 331.3 + 0.606 T<sub>C</sub></div>
                <div class="equation-pill">&lambda; = c / f</div>
                <div class="spec-text">ISO 9613-1 absorption coefficient:</div>
                <div class="equation-block">
                  <div>&alpha; = 8.686 f<sup>2</sup> [ (1.84e-11 (p/p<sub>0</sub>)<sup>-1</sup> (T/T<sub>0</sub>)<sup>1/2</sup>)</div>
                  <div>+ (T/T<sub>0</sub>)<sup>-2.5</sup> (0.01275 e<sup>-2239.1/T</sup> (f<sub>r,O</sub>/(f<sub>r,O</sub><sup>2</sup> + f<sup>2</sup>))</div>
                  <div>+ 0.1068 e<sup>-3352/T</sup> (f<sub>r,N</sub>/(f<sub>r,N</sub><sup>2</sup> + f<sup>2</sup>))) ]</div>
                </div>
                <div class="equation-block">
                  <div>C = -6.8346 (T<sub>01</sub>/T)<sup>1.261</sup> + 4.6151</div>
                  <div>p<sub>sat</sub> = p<sub>0</sub> &#183; 10<sup>C</sup>, h = RH &#183; p<sub>sat</sub> / p</div>
                  <div>f<sub>r,O</sub> = (p/p<sub>0</sub>) [24 + 4.04e4 h ((0.02 + h)/(0.391 + h))]</div>
                  <div>f<sub>r,N</sub> = (p/p<sub>0</sub>) (T/T<sub>0</sub>)<sup>-1/2</sup> [9 + 280 h e<sup>-4.17((T/T<sub>0</sub>)<sup>-1/3</sup> - 1)</sup>]</div>
                </div>
              </div>
            </div>
            <div class="spec-section spec-section--full">
              <div class="spec-heading">GROUND EFFECTS</div>
              <div class="spec-tray">
                <div class="spec-text">Legacy ISO 9613-2 Eq. 10 (soft ground):</div>
                <div class="equation-pill">
                  A<sub>gr</sub> = max(0, 4.8 - (2h<sub>m</sub> / d) (17 + 300 / d))
                </div>
                <div class="spec-text">Two-ray phasor geometry:</div>
                <div class="equation-pill">
                  r<sub>1</sub> = &radic;(d<sup>2</sup> + (h<sub>s</sub> - h<sub>r</sub>)<sup>2</sup>),
                  r<sub>2</sub> = &radic;(d<sup>2</sup> + (h<sub>s</sub> + h<sub>r</sub>)<sup>2</sup>)
                </div>
                <div class="spec-text">Normalized impedance (Delany-Bazley):</div>
                <div class="equation-pill">
                  &zeta; = 1 + 9.08 (f/&sigma;)<sup>-0.75</sup> - j 11.9 (f/&sigma;)<sup>-0.73</sup>
                </div>
                <div class="spec-text">Reflection coefficient (locally reacting):</div>
                <div class="equation-pill">
                  &Gamma; = (&zeta; cos&#952; - 1) / (&zeta; cos&#952; + 1)
                </div>
                <div class="spec-text">Two-ray ratio and attenuation:</div>
                <div class="equation-block">
                  <div>ratio = 1 + &Gamma; (r<sub>1</sub>/r<sub>2</sub>) e<sup>-jk(r<sub>2</sub> - r<sub>1</sub>)</sup></div>
                  <div>A<sub>gr</sub> = -20 log<sub>10</sub>(max(|ratio|, 10<sup>-6</sup>))</div>
                </div>
              </div>
            </div>
            <div class="spec-section spec-section--full">
              <div class="spec-heading">BARRIER DIFFRACTION</div>
              <div class="spec-tray">
                <div class="spec-text">Thin barrier (single edge):</div>
                <div class="equation-block">
                  <div>A = &radic;(d(S,I)<sup>2</sup> + (h<sub>b</sub> - h<sub>s</sub>)<sup>2</sup>)</div>
                  <div>B = &radic;(d(I,R)<sup>2</sup> + (h<sub>b</sub> - h<sub>r</sub>)<sup>2</sup>)</div>
                  <div>&delta; = A + B - d<sub>direct</sub></div>
                </div>
                <div class="spec-text">Thick barrier (building roof):</div>
                <div class="equation-block">
                  <div>A = &radic;(d(S,I<sub>in</sub>)<sup>2</sup> + (h<sub>b</sub> - h<sub>s</sub>)<sup>2</sup>)</div>
                  <div>B = d(I<sub>in</sub>, I<sub>out</sub>)</div>
                  <div>C = &radic;(d(I<sub>out</sub>,R)<sup>2</sup> + (h<sub>b</sub> - h<sub>r</sub>)<sup>2</sup>)</div>
                  <div>&delta; = A + B + C - d<sub>direct</sub></div>
                </div>
                <div class="spec-text">Maekawa-style insertion loss:</div>
                <div class="equation-pill">N = 2&delta; / &lambda;</div>
                <div class="equation-pill">A<sub>bar</sub> &#8776; 10 log<sub>10</sub>(3 + 20N)</div>
              </div>
            </div>
            <div class="spec-section">
              <div class="spec-heading">WEIGHTING</div>
              <div class="spec-tray">
                <div class="spec-text">Octave-band weighting:</div>
                <div class="equation-pill">L<sub>A</sub> = L<sub>band</sub> + A(f)</div>
                <div class="equation-pill">L<sub>C</sub> = L<sub>band</sub> + C(f)</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="./main.js"></script>

    <!-- Author/About Modal -->
    <div class="modal" id="authorModal" aria-hidden="true">
      <div class="modal-backdrop" data-modal-close></div>
      <div class="modal-card modal-plate" role="dialog" aria-modal="true" aria-labelledby="authorTitle" style="width: min(400px, 90vw);">
        <div class="modal-header">
          <div class="modal-title">
            <h2 id="authorTitle">About GeoNoise</h2>
          </div>
          <button class="modal-close ui-button" id="authorClose" type="button" aria-label="Close">X</button>
        </div>
<div class="spec-tray" style="text-align: center;">
          <div style="font-size: 18px; font-weight: 600; color: var(--text); margin-bottom: 4px;">GeoNoise</div>
          <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 16px;">Version 0.3.0</div>
          <div style="height: 1px; background: var(--border-soft); margin: 12px 0;"></div>
          <div style="font-size: 13px; color: var(--text-soft); margin-bottom: 8px;">Developed by</div>
<div style="font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 12px;">Sergio Pe√±a</div>
          <a
            href="https://www.linkedin.com/in/sergio-pena-a8108684/"
            target="_blank"
            rel="noopener noreferrer"
            style="
              display: inline-flex;
              align-items: center;
              justify-content: center;
              gap: 8px;
              padding: 10px 20px;
              border-radius: 999px;
              background: linear-gradient(145deg, var(--surface-hi), var(--surface-lo));
              box-shadow: var(--shadow-raised);
              color: var(--text);
              font-size: 13px;
              font-weight: 600;
              text-decoration: none;
              transition: transform 120ms ease, box-shadow 120ms ease;
            "
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
            Connect on LinkedIn
          </a>
          <div style="height: 1px; background: var(--border-soft); margin: 16px 0 12px;"></div>
          <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 12px;">
            Built as a fun experiment and practice experience with
          </div>
          <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 12px;">
            <span style="
              padding: 4px 10px;
              border-radius: 999px;
              background: linear-gradient(145deg, var(--surface-hi), var(--surface-lo));
              box-shadow: 2px 2px 4px var(--shadow-dark), -2px -2px 4px var(--shadow-light);
              font-size: 10px;
              font-weight: 600;
              color: var(--text-soft);
            ">Anthropic Claude Opus 4</span>
            <span style="
              padding: 4px 10px;
              border-radius: 999px;
              background: linear-gradient(145deg, var(--surface-hi), var(--surface-lo));
              box-shadow: 2px 2px 4px var(--shadow-dark), -2px -2px 4px var(--shadow-light);
              font-size: 10px;
              font-weight: 600;
              color: var(--text-soft);
            ">OpenAI Codex</span>
            <span style="
              padding: 4px 10px;
              border-radius: 999px;
              background: linear-gradient(145deg, var(--surface-hi), var(--surface-lo));
              box-shadow: 2px 2px 4px var(--shadow-dark), -2px -2px 4px var(--shadow-light);
              font-size: 10px;
              font-weight: 600;
              color: var(--text-soft);
            ">Google Gemini Pro</span>
          </div>
          <div style="height: 1px; background: var(--border-soft); margin: 0 0 12px;"></div>
          <div style="font-size: 11px; color: var(--text-muted);">
            ¬© 2025 Sergio Pe√±a. All rights reserved.
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
