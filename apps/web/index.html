<!doctype html>
<html lang="en" data-theme="default" data-feature-profile-dropdown="false">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GeoNoise</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="./styles/theme.css" />
    <link rel="stylesheet" href="./style.css" />
    <script type="importmap">
      {
        "imports": {
          "@geonoise/shared": "/packages/shared/dist/index.js",
          "@geonoise/core": "/packages/core/dist/index.js",
          "@geonoise/core/coords": "/packages/core/dist/coords/index.js",
          "@geonoise/geo": "/packages/geo/dist/index.js",
          "@geonoise/engine": "/packages/engine/dist/index.js",
          "@geonoise/engine-backends": "/packages/engine-backends/dist/index.js",
          "@geonoise/engine-webgpu": "/packages/engine-webgpu/dist/index.js",
          "zod": "https://esm.sh/zod@3.22.4"
        }
      }
    </script>
  </head>
  <body>
    <div class="app-shell">
      <!-- Fullscreen map canvas layer. -->
      <div class="canvas-frame">
        <canvas id="mapCanvas"></canvas>
        <div class="snap-indicator" id="snapIndicator"></div>
        <!-- Help button and status on left side -->
        <div class="canvas-corner-left" id="canvasCornerLeft">
          <div class="canvas-help" id="canvasHelp">
            <button
              class="ghost ui-button canvas-help-button"
              id="canvasHelpButton"
              type="button"
              aria-expanded="false"
              aria-label="Canvas help"
            >
              ?
            </button>
            <div class="canvas-help-tooltip" id="canvasHelpTooltip" role="tooltip">
              <div class="canvas-help-title">Canvas Controls</div>
              <div class="canvas-help-body">
                <strong>Navigation</strong><br>
                Drag: Pan the map<br>
                Scroll: Zoom in/out<br><br>
                <strong>Selection</strong><br>
                Click: Select item<br>
                âŒ˜+Drag: Box select multiple<br>
                Double-click: Quick edit<br><br>
                <strong>Editing</strong><br>
                Drag element: Move (live update)<br>
                Shift+Drag: Duplicate item<br>
                âŒ˜+D: Duplicate selected<br>
                Delete/Backspace: Remove selected<br>
                Escape: Deselect / Cancel<br><br>
                <strong>Tools</strong><br>
                V: Select &nbsp; S: Source &nbsp; R: Receiver<br>
                B: Barrier &nbsp; H: Building &nbsp; G: Grid<br>
                P: Probe
              </div>
            </div>
          </div>
          <!-- Status info to the right of help button -->
          <div class="canvas-status">
            <div class="scale-bar">
              <div class="scale-line" id="scaleLine"></div>
              <div class="scale-text" id="scaleText">100 m</div>
            </div>
            <div class="canvas-status-line" aria-live="polite">
              <span class="canvas-status-item">x: <span id="debug-x">0.0</span>m y: <span id="debug-y">0.0</span>m</span>
              <span class="canvas-status-sep">|</span>
              <span class="canvas-status-item">Units: Meters</span>
              <span class="canvas-status-sep">|</span>
              <span class="canvas-status-item">Mode: <span id="debug-mode">Select</span></span>
              <span class="canvas-status-sep">|</span>
              <button
                class="status-refine-button"
                id="refineButton"
                type="button"
                title="Force high-quality refine"
                aria-label="Force high-quality refine"
              >
                <span class="status-refine-icon" aria-hidden="true">âŸ³</span>
                <span>Refine</span>
              </button>
            </div>
          </div>
        </div>
        <!-- Color bar and settings on right side -->
        <div class="canvas-corner">
          <div class="db-legend" id="dbLegend" role="group" aria-label="Decibel legend">
            <div class="db-legend-bar">
              <div class="db-legend-gradient" id="dbLegendGradient" aria-hidden="true"></div>
              <div class="db-legend-labels" id="dbLegendLabels">
                <span>30 dB</span>
                <span>85 dB</span>
              </div>
            </div>
          </div>
          <!-- Settings gear button next to color bar -->
          <div class="settings-toggle" id="settingsToggle">
            <button
              class="ghost ui-button canvas-help-button"
              id="settingsButton"
              type="button"
              aria-expanded="false"
              aria-controls="settingsPopover"
              aria-label="Settings"
              title="Display and simulation settings"
            >
              âš™
            </button>
            <div class="settings-popover settings-popover--corner" id="settingsPopover" aria-hidden="true">
              <!-- Category Selection Stack -->
              <div class="settings-categories" id="settingsCategories">
                <div class="settings-header">settings</div>

                <!-- Profile Banner - Thin raised dropdown -->
                <div class="settings-profile-banner">
                  <select id="calculationProfile">
                    <option value="iso9613">ISO 9613-2 Compliant</option>
                    <option value="accurate" selected>Physically Accurate</option>
                    <option value="custom">Custom</option>
                  </select>
                </div>

                <div class="settings-category-stack">
                  <button class="settings-category-btn" id="settingsCatPhysics" data-category="physics" type="button">
                    physics
                  </button>
                  <button class="settings-category-btn" id="settingsCatEnviron" data-category="environmental" type="button">
                    environmental
                  </button>
                  <button class="settings-category-btn" id="settingsCatDisplay" data-category="display" type="button">
                    display
                  </button>
                  <button class="settings-category-btn" id="settingsCatLayers" data-category="layers" type="button">
                    layers
                  </button>
                </div>
              </div>
            </div>

            <!-- Slide-out Panel (separate popup to the left of settings) -->
            <div class="settings-slide-popup" id="settingsSlidePopup" aria-hidden="true">
              <!-- Display Panel -->
              <div class="settings-slide-panel" id="settingsPanelDisplay" data-panel="display">
<div class="settings-panel-header">display</div>
                <div class="settings-panel-content">
                  <div class="settings-section">
                    <div class="settings-title">frequency</div>
                    <label class="property-row property-row-stack">
                      <span>Weighting</span>
                      <select class="ui-inset" id="displayWeighting">
                        <option value="A" selected>A-weighting (dBA)</option>
                        <option value="C">C-weighting (dBC)</option>
                        <option value="Z">Z-weighting (dBZ / Linear)</option>
                      </select>
                    </label>
                    <label class="property-row property-row-stack">
                      <span>Display Band</span>
                      <select class="ui-inset" id="displayBand">
                        <option value="overall" selected>Overall (Sum)</option>
                        <option value="0">63 Hz</option>
                        <option value="1">125 Hz</option>
                        <option value="2">250 Hz</option>
                        <option value="3">500 Hz</option>
                        <option value="4">1000 Hz</option>
                        <option value="5">2000 Hz</option>
                        <option value="6">4000 Hz</option>
                        <option value="7">8000 Hz</option>
                        <option value="8">16000 Hz</option>
                      </select>
                    </label>
                  </div>
                  <div class="settings-section">
                    <div class="settings-title">map rendering</div>
                    <label class="toggle" for="mapRenderStyle">
                      <input type="checkbox" id="mapRenderStyle" />
                      <span>Contour Mode</span>
                    </label>
                    <div class="property-row map-band-step" id="mapBandStepRow">
                      <span>Band Step (dB)</span>
                      <input class="ui-inset" id="mapBandStep" type="number" min="1" max="20" step="1" value="3" />
                    </div>
                    <label class="toggle" for="mapAutoScale">
                      <input type="checkbox" id="mapAutoScale" checked />
                      <span>Auto-scale colors</span>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Environmental Panel -->
              <div class="settings-slide-panel" id="settingsPanelEnviron" data-panel="environmental">
<div class="settings-panel-header">environmental</div>
                <div class="settings-panel-content">
                  <div class="settings-section">
                    <div class="settings-title">conditions</div>
                    <label class="property-row property-row-stack">
                      <span>Temperature</span>
                      <div class="input-with-unit">
                        <input type="number" class="ui-inset" id="meteoTemperature" value="20" min="-10" max="40" step="1" />
                        <span class="unit-label">Â°C</span>
                      </div>
                    </label>
                    <label class="property-row property-row-stack">
                      <span>Relative Humidity</span>
                      <div class="input-with-unit">
                        <input type="number" class="ui-inset" id="meteoHumidity" value="50" min="10" max="100" step="5" />
                        <span class="unit-label">%</span>
                      </div>
                    </label>
                    <label class="property-row property-row-stack">
                      <span>Atmospheric Pressure</span>
                      <div class="input-with-unit">
                        <input type="number" class="ui-inset" id="meteoPressure" value="101.325" min="95" max="108" step="0.1" />
                        <span class="unit-label">kPa</span>
                      </div>
                    </label>
                    <div class="property-row property-row-stack derived-value">
                      <span>Speed of Sound</span>
                      <div class="derived-display" id="derivedSpeedOfSound">343.4 m/s</div>
                    </div>
                  </div>
                  <div class="settings-section">
                    <div class="settings-title">atmospheric absorption</div>
                    <label class="property-row property-row-stack">
                      <span>Model</span>
                      <select class="ui-inset" id="propagationAbsorption">
                        <option value="iso9613">ISO 9613-1</option>
                        <option value="simple">Simple</option>
                        <option value="none">None (Disabled)</option>
                      </select>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Physics Panel -->
              <div class="settings-slide-panel" id="settingsPanelPhysics" data-panel="physics">
                <div class="settings-panel-header">physics</div>
                <div class="settings-panel-content">
                  <div class="settings-section">
                    <div class="settings-title">ground effects</div>
                    <label class="toggle" for="propagationGroundReflection">
                      <input type="checkbox" id="propagationGroundReflection" />
                      <span>Ground Effects</span>
                    </label>
                    <label class="property-row property-row-stack">
                      <span>Ground Type</span>
                      <select class="ui-inset" id="propagationGroundType">
                        <option value="hard">Hard (Asphalt, Concrete)</option>
                        <option value="mixed" selected>Mixed</option>
                        <option value="soft">Soft (Grass, Soil)</option>
                      </select>
                    </label>
                    <label class="property-row property-row-stack" id="propagationGroundMixedSigmaModelRow">
                      <span>Mixed Ground Model</span>
                      <select class="ui-inset" id="propagationGroundMixedSigmaModel">
                        <option value="iso9613" selected>ISO 9613-2 (Compliant)</option>
                        <option value="logarithmic">Logarithmic (Accurate)</option>
                      </select>
                    </label>
                    <label class="property-row property-row-stack">
                      <span>Ground Algorithm</span>
                      <select class="ui-inset" id="propagationGroundModel">
                        <option value="twoRayPhasor">Two-Ray</option>
                        <option value="legacy">ISO 9613-2</option>
                      </select>
                    </label>
                  </div>
                  <div class="settings-section">
                    <div class="settings-title">propagation</div>
                    <label class="property-row property-row-stack">
                      <span>Spreading Loss</span>
                      <select class="ui-inset" id="propagationSpreading">
                        <option value="spherical">Spherical</option>
                        <option value="cylindrical">Cylindrical</option>
                      </select>
                    </label>
                    <label class="property-row property-row-stack">
                      <span>Barrier Side Diffraction</span>
                      <select class="ui-inset" id="propagationBarrierSideDiffraction">
                        <option value="off">Off (Over-top only)</option>
                        <option value="auto" selected>Auto (< 50m barriers)</option>
                        <option value="on">On (All barriers)</option>
                      </select>
                    </label>
                  </div>
                </div>
              </div>

              <!-- Layers Panel -->
              <div class="settings-slide-panel" id="settingsPanelLayers" data-panel="layers">
                <div class="settings-panel-header">layers</div>
                <div class="settings-panel-content">
                  <div class="settings-section">
                    <div class="settings-title">visibility</div>
                    <label class="toggle" for="layerSources">
                      <input type="checkbox" id="layerSources" checked />
                      <span>Sources</span>
                    </label>
                    <label class="toggle" for="layerReceivers">
                      <input type="checkbox" id="layerReceivers" checked />
                      <span>Receivers</span>
                    </label>
                    <label class="toggle" for="layerPanels">
                      <input type="checkbox" id="layerPanels" checked />
                      <span>Measure Grids</span>
                    </label>
                    <label class="toggle" for="layerNoiseMap">
                      <input type="checkbox" id="layerNoiseMap" />
                      <span>Noise Map</span>
                    </label>
                    <label class="toggle" for="layerGrid">
                      <input type="checkbox" id="layerGrid" />
                      <span>Grid Overlay</span>
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Floating UI overlay (non-blocking except for interactive elements). -->
      <div class="ui-layer">
        <header class="topbar topbar-floating">
<div class="topbar-left">
            <div class="topbar-actions">
<button class="ghost ui-button undo-redo-btn" id="undoButton" type="button" title="Undo the last change." aria-label="Undo">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 4v6h6"/>
                  <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                </svg>
              </button>
              <button class="ghost ui-button undo-redo-btn" id="redoButton" type="button" title="Redo the last change." aria-label="Redo">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M23 4v6h-6"/>
                  <path d="M20.49 15a9 9 0 1 1-2.13-9.36L23 10"/>
                </svg>
              </button>
            </div>
          </div>
          <div class="topbar-center">
            <div class="brand brand--debossed">
              <div class="brand-icon" aria-hidden="true">
                <span class="brand-ring ring-1"></span>
                <span class="brand-ring ring-2"></span>
                <span class="brand-ring ring-3"></span>
                <span class="brand-core"></span>
              </div>
              <div class="brand-title">geonoise</div>
            </div>
          </div>
          <div class="topbar-right">
            <div class="control-module">
              <div class="run-group">
                <button
                  class="primary ui-button"
                  id="computeButton"
                  type="button"
                  title="Run propagation and update receiver/grid levels."
                >
                  Compute
                </button>
                <!-- Whole-scene noise map ("Mesh All"): compute a padded grid and render as a heatmap overlay. -->
                <button class="primary ui-button" id="meshButton" type="button" title="Generate a whole-scene noise map.">
                  Generate Map
                </button>
                <div class="status-chip status-chip--small" id="computeChip" aria-label="Compute status">Ready</div>
              </div>
              <div class="run-options is-hidden" aria-hidden="true">
                <label for="computePreference">CPU</label>
                <div class="select-shell">
                  <select class="ui-inset" id="computePreference">
                    <option value="cpu">CPU</option>
                  </select>
                </div>
              </div>
<!-- Lightweight feedback for heavy map computation (keeps UI responsive). -->
              <div class="map-toast" id="mapToast" role="status" aria-live="polite"></div>
            </div>
<button class="ghost ui-button" id="aboutButton" type="button" title="Model notes, assumptions, and limitations.">
              Details
            </button>
            <button class="ghost ui-button" id="authorButton" type="button" title="About GeoNoise">
              About
            </button>
          </div>
        </header>

        <!-- Layers popover removed - now integrated into Settings panel -->

        <!-- Bottom dock for creation tools. -->
        <div class="dock" id="dock">
          <!-- Collapsed FAB trigger -->
          <button class="dock-fab" id="dockFab" type="button" aria-label="Open tools" aria-expanded="false">
            <span class="dock-fab-icon">+</span>
          </button>
          <!-- Expandable tools container -->
          <div class="dock-expandable" id="dockExpandable">
            <div class="dock-stack">
              <div class="dock-label-stage" id="dockLabelStage" aria-hidden="true">
                <span id="dockLabelText"></span>
              </div>
              <div class="dock-tools" id="toolGrid">
              <button
                class="dock-button ui-button is-active"
                data-tool="select"
                data-label="Select Tool (V)"
                type="button"
                aria-label="Select (V)"
              >
                <span class="dock-label">V</span>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-source"
                data-label="Add Source (S)"
                type="button"
                aria-label="Add Source (S)"
              >
                <span class="dock-label">S</span>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-receiver"
                data-label="Add Receiver (R)"
                type="button"
                aria-label="Add Receiver (R)"
              >
                <span class="dock-label">R</span>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-probe"
                data-label="Add Probe (P)"
                type="button"
                aria-label="Add Probe (P)"
              >
                <svg class="dock-icon" viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    d="M12 3a3 3 0 0 0-3 3v6a3 3 0 0 0 6 0V6a3 3 0 0 0-3-3z"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M5 11a7 7 0 0 0 14 0M12 18v3M8 21h8"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-barrier"
                data-label="Add Barrier (B)"
                type="button"
                aria-label="Add Barrier (B)"
              >
                <span class="dock-label">B</span>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-building"
                data-label="Add Building (H)"
                type="button"
                aria-label="Add Building (H)"
              >
                <span class="dock-label">H</span>
              </button>
              <button
                class="dock-button ui-button"
                data-tool="add-panel"
                data-label="Add Measure Grid (G)"
                type="button"
                aria-label="Add Measure Grid (G)"
              >
                <span class="dock-label">G</span>
              </button>
            </div>
          </div>
          </div>
          <div class="dock-instruction-bottom">Click to select. Drag to move. Shift+drag to duplicate.</div>
        </div>
        <!-- Contextual inspector shown only when a selection exists. -->
        <aside class="context-panel" id="contextPanel" aria-hidden="true">
          <div class="context-header" id="contextHeader">
            <div class="context-title-wrap">
              <div class="context-title" id="contextTitle">Select an element</div>
            </div>
            <div class="probe-actions">
              <button
                class="probe-pin ui-button"
                id="contextPin"
                type="button"
                aria-label="Pin inspector window"
                aria-pressed="false"
                title="Pin inspector (keeps panel open when clicking elsewhere)"
              >
                ğŸ“Œ
              </button>
              <button class="context-close ui-button" id="contextClose" type="button" aria-label="Close inspector">Ã—</button>
            </div>
          </div>
          <div class="inspector-body">
            <div class="inspector-row">
              <span>Mode</span>
              <strong id="modeLabel">Select</strong>
            </div>
            <div class="inspector-row">
              <span>Snap</span>
              <strong>5 m</strong>
            </div>
            <div class="inspector-hint" id="selectionHint">Click an item to edit it.</div>
          </div>
          <div class="context-section">
            <div class="context-section-title">Properties</div>
            <div class="properties" id="propertiesBody">Select an item to edit its properties.</div>
          </div>
          <div class="context-section" id="panelStatsSection">
            <div class="context-section-title">Measure Grid Stats</div>
            <div class="panel-legend" id="panelLegend"></div>
            <div class="panel-stats" id="panelStats"></div>
          </div>
        </aside>

        <aside class="probe-panel" id="probePanel" aria-hidden="true">
          <div class="probe-header">
            <div class="probe-title" id="probeTitle">Probe</div>
            <div class="probe-actions">
              <button
                class="probe-freeze ui-button"
                id="probeFreeze"
                type="button"
                aria-label="Freeze probe snapshot"
                title="Freeze probe snapshot"
              >
                â„
              </button>
              <button
                class="probe-pin ui-button"
                id="probePin"
                type="button"
                aria-label="Pin monitoring window"
                aria-pressed="false"
                title="Pin monitoring window"
              >
                ğŸ“Œ
              </button>
              <button class="probe-close ui-button" id="probeClose" type="button" aria-label="Close probe inspector">
                x
              </button>
            </div>
          </div>
          <div class="probe-meta">
            <span>Frequency Response</span>
            <span class="probe-status" id="probeStatus">Idle</span>
          </div>
          <div class="probe-chart">
            <canvas id="probeChart"></canvas>
          </div>
          <div class="probe-footer">
            <span>Frequency (Hz)</span>
            <span>Amplitude (dB)</span>
          </div>
        </aside>
      </div>
    </div>

    <div class="modal" id="aboutModal" aria-hidden="true">
      <div class="modal-backdrop" data-modal-close></div>
      <div class="modal-card modal-plate" role="dialog" aria-modal="true" aria-labelledby="aboutTitle">
        <div class="modal-header">
          <div class="modal-title">
            <h2 id="aboutTitle">Details</h2>
            <p class="modal-subtitle">Real-time 2.5 dimension outdoor acoustic simulation</p>
          </div>
          <button class="modal-close ui-button" id="aboutClose" type="button" aria-label="Close">X</button>
        </div>
        <div class="about-tabs" role="tablist" aria-label="About tabs">
          <button
            class="about-tab is-active"
            type="button"
            role="tab"
            id="aboutTabCurrent"
            aria-selected="true"
            aria-controls="aboutPanelCurrent"
            data-about-tab="current"
          >
            Current
          </button>
          <button
            class="about-tab"
            type="button"
            role="tab"
            id="aboutTabEquations"
            aria-selected="false"
            aria-controls="aboutPanelEquations"
            data-about-tab="equations"
          >
            Full Equations
          </button>
        </div>
        <div
          class="about-panel is-active"
          role="tabpanel"
          id="aboutPanelCurrent"
          aria-labelledby="aboutTabCurrent"
          aria-hidden="false"
          data-about-panel="current"
        >
          <!-- Intro Section -->
          <div class="spec-section spec-section--full">
            <p class="section-intro">
              GeoNoise implements ISO 9613-based outdoor sound propagation with coherent phasor summation
              for multi-path interference modeling. All calculations are performed per octave band (63 Hz â€“ 16 kHz).
            </p>
            <div class="formula-highlight">
              L<sub>p</sub>(f) = L<sub>W</sub>(f) - A<sub>div</sub> - A<sub>atm</sub>(f) - A<sub>gr</sub>(f) - A<sub>bar</sub>(f)
            </div>
          </div>

          <!-- Expand All Button -->
          <button class="expand-all-btn" id="expandAllBtn" type="button">expand all</button>

          <!-- Collapsible Physics Sections -->
          <div class="spec-grid">

            <!-- Geometric Divergence -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">geometric divergence (A<sub>div</sub>)</span>
                    <span class="collapsible-subtitle">Spherical spreading: A = 20Â·logâ‚â‚€(d) + 11 dB</span>
                  </div>
                </div>
                <div class="collapsible-chevron">â–¼</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Point source spherical spreading models how sound energy spreads over an expanding sphere.</p>
                  <div class="formula-highlight">A<sub>div</sub> = 20Â·logâ‚â‚€(d) + 11 dB</div>
                  <p class="spec-text">where d = 3D distance (m), 11 dB = 10Â·logâ‚â‚€(4Ï€) for hemispherical radiation.</p>
                  <p class="spec-text"><strong>Derivation:</strong> Power flux Î¦ = W/(4Ï€rÂ²), therefore L<sub>p</sub> = L<sub>W</sub> - 10Â·logâ‚â‚€(4Ï€rÂ²)</p>
                </div>
              </div>
            </div>

            <!-- Atmospheric Absorption -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">atmospheric absorption (A<sub>atm</sub>)</span>
                    <span class="collapsible-subtitle">ISO 9613-1 frequency-dependent air absorption</span>
                  </div>
                </div>
                <span class="standards-badge standards-badge--iso">ISO 9613-1</span>
                <div class="collapsible-chevron">â–¼</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Air absorbs sound energy through viscous, thermal, and molecular relaxation processes.</p>
                    <div class="formula-highlight">A<sub>atm</sub> = Î±(f) Â· d / 1000 dB</div>

                    <p class="spec-text" style="margin-top: 12px;"><strong>ISO 9613-1:</strong> Calculates Î± from temperature, humidity, and pressure.</p>
                  <div class="equation-pill" style="font-size: 12px;">
                    Î± = Î±<sub>cl</sub> + (b<sub>N</sub>Â·fÂ²)/(f<sub>r,N</sub> + fÂ²/f<sub>r,N</sub>) + (b<sub>O</sub>Â·fÂ²)/(f<sub>r,O</sub> + fÂ²/f<sub>r,O</sub>)
                  </div>
                  <p class="spec-text">The coefficient Î± combines classical losses with Nâ‚‚ and Oâ‚‚ molecular relaxation.</p>

                  <p class="spec-text" style="margin-top: 12px;"><strong>Simple:</strong> Uses the lookup table below at standard conditions (20Â°C, 70% RH).</p>
                  <table class="physics-table">
                    <tr><th>63 Hz</th><th>125 Hz</th><th>250 Hz</th><th>500 Hz</th><th>1 kHz</th><th>2 kHz</th><th>4 kHz</th><th>8 kHz</th><th>16 kHz</th></tr>
                    <tr><td>0.1</td><td>0.4</td><td>1.0</td><td>1.9</td><td>3.7</td><td>9.7</td><td>33</td><td>117</td><td>392</td></tr>
                  </table>
                  <p class="spec-text" style="margin-top: 6px; font-size: 11px; color: var(--text-muted);">Values in dB/km</p>
                </div>
              </div>
            </div>

            <!-- Ground Effect -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">ground effect (A<sub>gr</sub>)</span>
                    <span class="collapsible-subtitle">ISO 9613-2 regions or two-ray interference model</span>
                  </div>
                </div>
                <span class="standards-badge standards-badge--iso">ISO 9613-2</span>
                <div class="collapsible-chevron">â–¼</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Ground effect accounts for sound interaction with the ground surface. GeoNoise offers two models:</p>

                  <p class="spec-text" style="margin-top: 16px;"><strong>ISO 9613-2 Model (Standard Compliant):</strong></p>
                  <p class="spec-text">Divides the propagation path into three regions with frequency-dependent attenuation:</p>
                  <pre class="physics-diagram">  S â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ R
  â”‚â†â”€â”€ As â”€â”€â†’â”‚â†â”€â”€â”€â”€â”€â”€ Am â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚â†â”€â”€ Ar â”€â”€â†’â”‚
  â”‚  source  â”‚      middle        â”‚ receiver â”‚
  â”‚  region  â”‚      region        â”‚  region  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       dp,s         d - dp,s - dp,r      dp,r</pre>
                  <div class="formula-highlight">
                    A<sub>gr</sub> = A<sub>s</sub> + A<sub>r</sub> + A<sub>m</sub>
                  </div>
                  <p class="spec-text">where:</p>
                  <ul class="spec-list" style="margin-left: 20px;">
                    <li><strong>A<sub>s</sub></strong> = source region effect (depends on h<sub>s</sub>, d<sub>p,s</sub>, G, frequency)</li>
                    <li><strong>A<sub>r</sub></strong> = receiver region effect (depends on h<sub>r</sub>, d<sub>p,r</sub>, G, frequency)</li>
                    <li><strong>A<sub>m</sub></strong> = middle region effect (depends on d, h<sub>s</sub>+h<sub>r</sub>, G, frequency)</li>
                    <li><strong>G</strong> = ground factor (0 = hard, 1 = soft, 0.5 = mixed)</li>
                    <li><strong>d<sub>p</sub></strong> = min(30Ã—h, d) â€” characteristic distance for each region</li>
                  </ul>
                  <p class="spec-text">Coefficients from ISO 9613-2 Tables 3-4 vary by octave band (63 Hz â€“ 8 kHz).</p>

                  <p class="spec-text" style="margin-top: 16px;"><strong>Two-Ray Phasor Model (Physically Accurate):</strong></p>
                  <p class="spec-text">Models coherent interference between direct and ground-reflected paths:</p>
                  <pre class="physics-diagram">      S (source)
     /|\
    / | \  râ‚ = direct path
   /  |  \
  /   |hs \ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ R (receiver)
 /    |    \                  /
/     |     \      râ‚‚       / hr
â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€/â”€â”€â”€â”€â”€â”€  Ground (z=0)
             reflection point</pre>
                  <p class="spec-text"><strong>Path lengths:</strong></p>
                  <div class="formula-highlight" style="font-size: 13px;">
                    râ‚ = âˆš(dÂ² + (h<sub>s</sub> - h<sub>r</sub>)Â²) &nbsp;&nbsp;|&nbsp;&nbsp; râ‚‚ = âˆš(dÂ² + (h<sub>s</sub> + h<sub>r</sub>)Â²)
                  </div>
                  <p class="spec-text"><strong>Delany-Bazley normalized impedance:</strong></p>
                  <div class="equation-pill" style="font-size: 12px;">
                    Z<sub>n</sub> = 1 + 9.08(f/Ïƒ)<sup>-0.75</sup> + jÂ·11.9(f/Ïƒ)<sup>-0.73</sup>
                  </div>
                  <p class="spec-text">where Ïƒ = flow resistivity (hard: 200,000, soft: 20,000 PaÂ·s/mÂ²)</p>
                  <p class="spec-text"><strong>Coherent ground effect:</strong></p>
                  <div class="formula-highlight">
                    A<sub>gr</sub> = -20Â·logâ‚â‚€|1 + Î³Â·(râ‚/râ‚‚)Â·e<sup>jk(râ‚‚-râ‚)</sup>|
                  </div>
                  <p class="spec-text">This captures constructive/destructive interference (ground dip phenomenon).</p>

                  <p class="spec-text" style="margin-top: 16px;"><strong>Model Comparison:</strong></p>
                  <table class="physics-table">
                    <tr><th>Aspect</th><th>ISO 9613-2</th><th>Two-Ray Phasor</th></tr>
                    <tr><td>Standards</td><td>Compliant</td><td>Physics-based</td></tr>
                    <tr><td>Frequency</td><td>Per-band coefficients</td><td>Wavelength-based phase</td></tr>
                    <tr><td>Interference</td><td>Empirical approximation</td><td>Full wave interference</td></tr>
                    <tr><td>Ground dip</td><td>Not modeled</td><td>Naturally captured</td></tr>
                    <tr><td>Boost (A<sub>gr</sub> &lt; 0)</td><td>Allowed</td><td>Allowed</td></tr>
                  </table>
                </div>
              </div>
            </div>

            <!-- Barrier Diffraction -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">barrier diffraction</span>
                    <span class="collapsible-subtitle">Maekawa thin-screen model with side diffraction</span>
                  </div>
                </div>
                <span class="standards-badge standards-badge--empirical">Maekawa</span>
                <div class="collapsible-chevron">â–¼</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Sound diffracts over and around barriers. Attenuation depends on the path difference Î´.</p>

                  <p class="spec-text"><strong>Over-Top Diffraction (vertical):</strong></p>
                  <pre class="physics-diagram">    S                    R
     \                  /
      \   Î´ = A+B-d   /
       A â”€â”€â†’ â— â†â”€â”€ B
             â”‚
      â•â•â•â•â•â•â•â•§â•â•â•â•â•â•   Barrier</pre>
                  <div class="formula-highlight">Î´ = A + B - d &nbsp;&nbsp;|&nbsp;&nbsp; N = 2Î´f/c</div>
                  <p class="spec-text"><strong>Insertion loss:</strong></p>
                  <div class="formula-highlight">A<sub>bar</sub> = 10Â·logâ‚â‚€(3 + 20Â·N) &nbsp;&nbsp; capped at 20-25 dB</div>

                  <p class="spec-text" style="margin-top: 16px;"><strong>Side Diffraction (horizontal):</strong></p>
                  <p class="spec-text">Sound can also bend around the ends of finite-length barriers:</p>
                  <pre class="physics-diagram">      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  Barrier (top view)
     â—                  â—
   Left               Right
   Edge               Edge
     â†‘                  â†‘
  S â”€â”˜                  â””â”€ R
(around left)      (around right)</pre>
                  <p class="spec-text">Path difference for side: Î´ = |Sâ†’Edge| + |Edgeâ†’R| - |Sâ†’R|</p>
                  <p class="spec-text">The path with <strong>minimum Î´</strong> (over-top or around sides) determines the effective attenuation.</p>

                  <p class="spec-text" style="margin-top: 16px;"><strong>Side Diffraction Toggle:</strong></p>
                  <table class="physics-table">
                    <tr><th>Mode</th><th>Behavior</th></tr>
                    <tr><td><strong>Off</strong></td><td>ISO 9613-2 infinite barrier assumption. Only over-top diffraction.</td></tr>
                    <tr><td><strong>Auto</strong></td><td>Enable side diffraction for barriers &lt; 50m (recommended default).</td></tr>
                    <tr><td><strong>On</strong></td><td>Always compute side diffraction for all barriers.</td></tr>
                  </table>
                  <p class="spec-text" style="margin-top: 12px;"><em>Low frequencies diffract easily â†’ less attenuation. High frequencies are blocked effectively.</em></p>
                </div>
              </div>
            </div>

            <!-- Building Diffraction -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">building diffraction</span>
                    <span class="collapsible-subtitle">Double-edge over roof + around corners</span>
                  </div>
                </div>
                <div class="collapsible-chevron">â–¼</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">For thick obstacles, sound diffracts twice (entry + exit edges):</p>
                  <pre class="physics-diagram">    S                              R
     \                            /
      Aâ‚ â”€â”€â†’ â—â”€â”€â”€â”€â”€â”€â”€â”€â— â†â”€â”€ Aâ‚‚
             â”‚  ROOF  â”‚
      â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•   Building</pre>
                  <p class="spec-text"><strong>Path:</strong> Total = Aâ‚ + T (roof width) + Aâ‚‚</p>
                  <div class="formula-highlight">A<sub>bar</sub> = 10Â·logâ‚â‚€(3 + 40Â·N) &nbsp;&nbsp; capped at 25 dB</div>
                  <p class="spec-text">Note: coefficient is <strong>40</strong> (not 20) for double-edge diffraction.</p>
                  <p class="spec-text"><strong>Horizontal diffraction:</strong> Also computed around building corners using single-edge Maekawa. The minimum-loss path is selected.</p>

                  <p class="spec-text" style="margin-top: 16px;"><strong>Probe vs Grid Accuracy:</strong></p>
                  <div style="background: var(--surface-lo); border-radius: 8px; padding: 12px; margin-top: 8px;">
                    <p class="spec-text" style="margin: 0 0 8px 0;"><strong>Probe engine</strong> traces multiple diffraction paths (roof + all corners) and sums them coherently with phase. This is more physically accurate.</p>
                    <p class="spec-text" style="margin: 0 0 8px 0;"><strong>Receiver grid</strong> uses a simplified single-path model for real-time performance.</p>
                    <p class="spec-text" style="margin: 0; color: var(--text-muted);"><em>Expected difference: Probe shows 5-10 dB higher levels behind buildings due to multiple contributing paths. Use probes for final analysis at critical locations.</em></p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Wall Reflections -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">wall reflections</span>
                    <span class="collapsible-subtitle">Image source method, 1st-order</span>
                  </div>
                </div>
                <div class="collapsible-chevron">â–¼</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Reflections from building walls computed using virtual image sources:</p>
                  <pre class="physics-diagram">         Wall
           â”‚
   S â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€ R
    \      â”‚      /
     \     â”‚     /
      S'   â”‚   (S' = mirror of S across wall)</pre>
                  <div class="formula-highlight">|Î“| â‰ˆ 0.9 per reflection (10% absorption)</div>
                  <p class="spec-text">Reflections are validated for line-of-sight and checked against other buildings.</p>
                </div>
              </div>
            </div>

            <!-- Coherent Summation -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">coherent phasor summation</span>
                    <span class="collapsible-subtitle">Phase-accurate multi-path interference</span>
                  </div>
                </div>
                <div class="collapsible-chevron">â–¼</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <p class="spec-text">Multiple paths from the <strong>same source</strong> are summed with phase (capturing interference):</p>
                  <div class="formula-highlight">
                    p<sub>total</sub> = Î£áµ¢ páµ¢Â·e<sup>jÏ†áµ¢</sup> &nbsp;&nbsp; where Ï†áµ¢ = -kÂ·dáµ¢ + Ï†<sub>reflection</sub>
                  </div>
                  <p class="spec-text">This captures:</p>
                  <ul class="spec-list">
                    <li>Constructive interference (paths in-phase â†’ +6 dB)</li>
                    <li>Destructive interference (paths out-of-phase â†’ deep nulls)</li>
                    <li>Ground dip phenomenon at specific frequencies</li>
                    <li>Comb filtering from wall reflections</li>
                  </ul>
                  <p class="spec-text" style="margin-top: 10px;">Multiple <strong>sources</strong> are summed energetically (incoherent):</p>
                  <div class="formula-highlight">L<sub>p,total</sub> = 10Â·logâ‚â‚€[ Î£â±¼ 10<sup>(Lp,j/10)</sup> ]</div>
                </div>
              </div>
            </div>

            <!-- Accuracy & Limitations -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">accuracy & limitations</span>
                    <span class="collapsible-subtitle">Expected precision and model assumptions</span>
                  </div>
                </div>
                <div class="collapsible-chevron">â–¼</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <div class="accuracy-indicator">
                    <div class="accuracy-dot" style="background: #f5a623;"></div>
                    <span class="accuracy-text">Accuracy pending measurements and validation</span>
                  </div>
                  <p class="spec-text" style="margin-top: 12px;"><strong>Known Limitations:</strong></p>
                  <ul class="limitations-list">
                    <li>Flat terrain assumed (no topography effects)</li>
                    <li>Neutral atmosphere (no temperature/wind refraction)</li>
                    <li>First-order wall reflections only</li>
                    <li>2.5D geometry (vertical plane diffraction)</li>
                    <li>Homogeneous ground (single type per scene)</li>
                  </ul>
                  <p class="spec-text" style="margin-top: 12px;"><strong>Numerical Guards:</strong></p>
                  <ul class="limitations-list">
                    <li>Distance floor: d<sub>min</sub> = 0.1m to prevent division by zero</li>
                    <li>Angle limits: cos Î¸ clamped for grazing incidence</li>
                    <li>Impedance cap: |Z| bounded to avoid runaway coefficients</li>
                    <li>Level floor: -100 dB (acoustic silence threshold)</li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- References -->
            <div class="collapsible-section" data-collapsible>
              <div class="collapsible-header" tabindex="0" role="button" aria-expanded="false">
                <div class="collapsible-header-left">
                  <div class="collapsible-title-group">
                    <span class="collapsible-title">references</span>
                    <span class="collapsible-subtitle">Standards and academic sources</span>
                  </div>
                </div>
                <div class="collapsible-chevron">â–¼</div>
              </div>
              <div class="collapsible-divider"></div>
              <div class="collapsible-body">
                <div class="collapsible-content">
                  <ul class="references-list">
                    <li data-ref="[1]">ISO 9613-1:1993 â€” Acoustics â€” Attenuation of sound during propagation outdoors â€” Part 1: Calculation of absorption by atmosphere</li>
                    <li data-ref="[2]">ISO 9613-2:1996 â€” Acoustics â€” Attenuation of sound during propagation outdoors â€” Part 2: General method of calculation</li>
                    <li data-ref="[3]">Maekawa, Z. (1968). "Noise reduction by screens." Applied Acoustics, 1(3), 157-173</li>
                    <li data-ref="[4]">Delany, M.E. & Bazley, E.N. (1970). "Acoustical properties of fibrous absorbent materials." Applied Acoustics, 3(2), 105-116</li>
                    <li data-ref="[5]">Pierce, A.D. (1981). "Acoustics: An Introduction to Its Physical Principles and Applications." McGraw-Hill</li>
                  </ul>
                </div>
              </div>
            </div>

          </div>
        </div>
        <div
          class="about-panel"
          role="tabpanel"
          id="aboutPanelEquations"
          aria-labelledby="aboutTabEquations"
          aria-hidden="true"
          data-about-panel="equations"
        >
          <div class="spec-grid equations-grid">
            <div class="spec-section spec-section--full">
              <div class="spec-heading">CORE LEVELS</div>
              <div class="spec-tray">
                <div class="spec-text">Overall level at receiver:</div>
                <div class="equation-pill">
                  L<sub>p</sub> = L<sub>W</sub> - A<sub>div</sub> - A<sub>atm</sub> - A<sub>gr</sub> - A<sub>bar</sub>
                </div>
                <div class="spec-text">Energetic summation of multiple sources:</div>
                <div class="equation-pill">
                  L<sub>sum</sub> = 10 log<sub>10</sub>( &Sigma; 10<sup>L<sub>i</sub>/10</sup> )
                </div>
                <div class="spec-text">Sound power conversions:</div>
                <div class="equation-pill">L<sub>W</sub> = 10 log<sub>10</sub>(P / 10<sup>-12</sup>)</div>
                <div class="equation-pill">P = 10<sup>-12</sup> &#183; 10<sup>L<sub>W</sub>/10</sup></div>
              </div>
            </div>
            <div class="spec-section">
              <div class="spec-heading">GEOMETRY</div>
              <div class="spec-tray">
                <div class="spec-text">Plan distance:</div>
                <div class="equation-pill">d<sub>2D</sub> = &radic;((x<sub>2</sub>-x<sub>1</sub>)<sup>2</sup> + (y<sub>2</sub>-y<sub>1</sub>)<sup>2</sup>)</div>
                <div class="spec-text">3D distance:</div>
                <div class="equation-pill">
                  d<sub>3D</sub> = &radic;((x<sub>2</sub>-x<sub>1</sub>)<sup>2</sup> + (y<sub>2</sub>-y<sub>1</sub>)<sup>2</sup> + (z<sub>2</sub>-z<sub>1</sub>)<sup>2</sup>)
                </div>
                <div class="spec-text">Direct path used for diffraction reference:</div>
                <div class="equation-pill">d<sub>direct</sub> = &radic;(d<sub>2D</sub><sup>2</sup> + (h<sub>s</sub> - h<sub>r</sub>)<sup>2</sup>)</div>
              </div>
            </div>
            <div class="spec-section">
              <div class="spec-heading">SPREADING</div>
              <div class="spec-tray">
                <div class="spec-text">Point source (spherical):</div>
                <div class="equation-pill">A<sub>div</sub> = 20 log<sub>10</sub>(d) + 11</div>
                <div class="spec-text">Line source (cylindrical):</div>
                <div class="equation-pill">A<sub>div</sub> = 10 log<sub>10</sub>(d) + 8</div>
              </div>
            </div>
            <div class="spec-section spec-section--full">
              <div class="spec-heading">ATMOSPHERIC ABSORPTION</div>
              <div class="spec-tray">
                <div class="spec-text">Path loss:</div>
                <div class="equation-pill">A<sub>atm</sub> = &alpha; &#183; d</div>
                <div class="spec-text">Speed of sound and wavelength:</div>
                <div class="equation-pill">c = 331.3 + 0.606 T<sub>C</sub></div>
                <div class="equation-pill">&lambda; = c / f</div>
                <div class="spec-text">ISO 9613-1 absorption coefficient:</div>
                <div class="equation-block">
                  <div>&alpha; = 8.686 f<sup>2</sup> [ (1.84e-11 (p/p<sub>0</sub>)<sup>-1</sup> (T/T<sub>0</sub>)<sup>1/2</sup>)</div>
                  <div>+ (T/T<sub>0</sub>)<sup>-2.5</sup> (0.01275 e<sup>-2239.1/T</sup> (f<sub>r,O</sub>/(f<sub>r,O</sub><sup>2</sup> + f<sup>2</sup>))</div>
                  <div>+ 0.1068 e<sup>-3352/T</sup> (f<sub>r,N</sub>/(f<sub>r,N</sub><sup>2</sup> + f<sup>2</sup>))) ]</div>
                </div>
                <div class="equation-block">
                  <div>C = -6.8346 (T<sub>01</sub>/T)<sup>1.261</sup> + 4.6151</div>
                  <div>p<sub>sat</sub> = p<sub>0</sub> &#183; 10<sup>C</sup>, h = RH &#183; p<sub>sat</sub> / p</div>
                  <div>f<sub>r,O</sub> = (p/p<sub>0</sub>) [24 + 4.04e4 h ((0.02 + h)/(0.391 + h))]</div>
                  <div>f<sub>r,N</sub> = (p/p<sub>0</sub>) (T/T<sub>0</sub>)<sup>-1/2</sup> [9 + 280 h e<sup>-4.17((T/T<sub>0</sub>)<sup>-1/3</sup> - 1)</sup>]</div>
                </div>
              </div>
            </div>
            <div class="spec-section spec-section--full">
              <div class="spec-heading">GROUND EFFECTS</div>
              <div class="spec-tray">
                <div class="spec-text">Legacy ISO 9613-2 Eq. 10 (soft ground):</div>
                <div class="equation-pill">
                  A<sub>gr</sub> = max(0, 4.8 - (2h<sub>m</sub> / d) (17 + 300 / d))
                </div>
                <div class="spec-text">Two-ray phasor geometry:</div>
                <div class="equation-pill">
                  r<sub>1</sub> = &radic;(d<sup>2</sup> + (h<sub>s</sub> - h<sub>r</sub>)<sup>2</sup>),
                  r<sub>2</sub> = &radic;(d<sup>2</sup> + (h<sub>s</sub> + h<sub>r</sub>)<sup>2</sup>)
                </div>
                <div class="spec-text">Normalized impedance (Delany-Bazley):</div>
                <div class="equation-pill">
                  &zeta; = 1 + 9.08 (f/&sigma;)<sup>-0.75</sup> - j 11.9 (f/&sigma;)<sup>-0.73</sup>
                </div>
                <div class="spec-text">Reflection coefficient (locally reacting):</div>
                <div class="equation-pill">
                  &Gamma; = (&zeta; cos&#952; - 1) / (&zeta; cos&#952; + 1)
                </div>
                <div class="spec-text">Two-ray ratio and attenuation:</div>
                <div class="equation-block">
                  <div>ratio = 1 + &Gamma; (r<sub>1</sub>/r<sub>2</sub>) e<sup>-jk(r<sub>2</sub> - r<sub>1</sub>)</sup></div>
                  <div>A<sub>gr</sub> = -20 log<sub>10</sub>(max(|ratio|, 10<sup>-6</sup>))</div>
                </div>
              </div>
            </div>
            <div class="spec-section spec-section--full">
              <div class="spec-heading">BARRIER DIFFRACTION</div>
              <div class="spec-tray">
                <div class="spec-text">Thin barrier (single edge):</div>
                <div class="equation-block">
                  <div>A = &radic;(d(S,I)<sup>2</sup> + (h<sub>b</sub> - h<sub>s</sub>)<sup>2</sup>)</div>
                  <div>B = &radic;(d(I,R)<sup>2</sup> + (h<sub>b</sub> - h<sub>r</sub>)<sup>2</sup>)</div>
                  <div>&delta; = A + B - d<sub>direct</sub></div>
                </div>
                <div class="spec-text">Thick barrier (building roof):</div>
                <div class="equation-block">
                  <div>A = &radic;(d(S,I<sub>in</sub>)<sup>2</sup> + (h<sub>b</sub> - h<sub>s</sub>)<sup>2</sup>)</div>
                  <div>B = d(I<sub>in</sub>, I<sub>out</sub>)</div>
                  <div>C = &radic;(d(I<sub>out</sub>,R)<sup>2</sup> + (h<sub>b</sub> - h<sub>r</sub>)<sup>2</sup>)</div>
                  <div>&delta; = A + B + C - d<sub>direct</sub></div>
                </div>
                <div class="spec-text">Maekawa-style insertion loss:</div>
                <div class="equation-pill">N = 2&delta; / &lambda;</div>
                <div class="equation-pill">A<sub>bar</sub> &#8776; 10 log<sub>10</sub>(3 + 20N)</div>
              </div>
            </div>
            <div class="spec-section">
              <div class="spec-heading">WEIGHTING</div>
              <div class="spec-tray">
                <div class="spec-text">Octave-band weighting:</div>
                <div class="equation-pill">L<sub>A</sub> = L<sub>band</sub> + A(f)</div>
                <div class="equation-pill">L<sub>C</sub> = L<sub>band</sub> + C(f)</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="./main.js"></script>

    <!-- Author/About Modal -->
    <div class="modal" id="authorModal" aria-hidden="true">
      <div class="modal-backdrop" data-modal-close></div>
      <div class="modal-card modal-plate" role="dialog" aria-modal="true" aria-labelledby="authorTitle" style="width: min(400px, 90vw);">
        <div class="modal-header">
          <div class="modal-title">
            <h2 id="authorTitle">About GeoNoise</h2>
          </div>
          <button class="modal-close ui-button" id="authorClose" type="button" aria-label="Close">X</button>
        </div>
<div class="spec-tray" style="text-align: center;">
<div style="font-size: 18px; font-weight: 600; color: var(--text); margin-bottom: 4px;">GeoNoise</div>
          <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 16px;">Version 0.6.0</div>
          <div style="height: 1px; background: var(--border-soft); margin: 12px 0;"></div>
          <div style="font-size: 13px; color: var(--text-soft); margin-bottom: 8px;">Developed by</div>
<div style="font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 12px;">Sergio PeÃ±a</div>
          <a
            href="https://www.linkedin.com/in/sergio-pena-a8108684/"
            target="_blank"
            rel="noopener noreferrer"
            style="
              display: inline-flex;
              align-items: center;
              justify-content: center;
              gap: 8px;
              padding: 10px 20px;
              border-radius: 999px;
              background: linear-gradient(145deg, var(--surface-hi), var(--surface-lo));
              box-shadow: var(--shadow-raised);
              color: var(--text);
              font-size: 13px;
              font-weight: 600;
              text-decoration: none;
              transition: transform 120ms ease, box-shadow 120ms ease;
            "
          >
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
            Connect on LinkedIn
          </a>
          <div style="height: 1px; background: var(--border-soft); margin: 16px 0 12px;"></div>
          <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 12px;">
            Built as a fun experiment and practice experience with
          </div>
          <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-bottom: 12px;">
            <span style="
              padding: 4px 10px;
              border-radius: 999px;
              background: linear-gradient(145deg, var(--surface-hi), var(--surface-lo));
              box-shadow: 2px 2px 4px var(--shadow-dark), -2px -2px 4px var(--shadow-light);
              font-size: 10px;
              font-weight: 600;
              color: var(--text-soft);
            ">Anthropic Claude Opus 4.5</span>
            <span style="
              padding: 4px 10px;
              border-radius: 999px;
              background: linear-gradient(145deg, var(--surface-hi), var(--surface-lo));
              box-shadow: 2px 2px 4px var(--shadow-dark), -2px -2px 4px var(--shadow-light);
              font-size: 10px;
              font-weight: 600;
              color: var(--text-soft);
            ">OpenAI Codex</span>
            <span style="
              padding: 4px 10px;
              border-radius: 999px;
              background: linear-gradient(145deg, var(--surface-hi), var(--surface-lo));
              box-shadow: 2px 2px 4px var(--shadow-dark), -2px -2px 4px var(--shadow-light);
              font-size: 10px;
              font-weight: 600;
              color: var(--text-soft);
            ">Google Gemini Pro</span>
          </div>
          <div style="height: 1px; background: var(--border-soft); margin: 0 0 12px;"></div>
          <div style="font-size: 11px; color: var(--text-muted);">
            Â© 2025 Sergio PeÃ±a. All rights reserved.
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
